{"name":"Openshift-nginx-cartridge","tagline":"A Scalable NGINX Cartridge for OpenShift.","body":"## Scalable Openshift Nginx Cartridge\r\n\r\nA cartridge for OpenShift that enables NGINX to be used. This OpenShift cartidge is scalable, I've tested it with 3 gears, it worked jolly good. No reason to believe it wouldn't work with a larger amount. \r\n\r\nThis is a forked version of someone elses work from [here](https://github.com/gsterjov/openshift-nginx-cartridge). It has been updated to NGINX version 1.7.9, and some of the NGINX modules are different than the original. The NGINX config file supplied with the cartidge has also been changed.\r\n\r\n### Installation\r\n\r\nTo install this cartridge you use the cartridge reflector from the command line. In the example below a \"myapp\" directory will be created in the location where the command is run as the git repo where your static web content will live will be cloned there.\r\n\r\n\trhc create-app --scaling myapp http://cartreflect-claytondev.rhcloud.com/reflect?github=dustyherald/openshift-nginx-cartridge\r\n\r\n\r\n### Configuration\r\n\r\nThe cartridge installs two config files. One at <code>$OPENSHIFT_NGINX_DIR/conf/nginx.conf</code> which gets loaded by the executable\r\nand sets up specific app configuration such as logs and pid files.\r\n\r\nThe config then includes another nginx.conf which must exist at <code>$OPENSHIFT_REPO_DIR/nginx.conf</code>. This config should\r\ncontain all your server specific set up including which ip/port to listen on.\r\n\r\nThe repo nginx.conf is actually seen in your repository as <code>nginx.conf.erb</code> so environment variables can be used\r\nin the config. Every time the server starts it first processes <code>nginx.conf.erb</code>.\r\n\r\n\r\nA <code>public/</code> folder is included where static content is served by default. However, as can be seen in the <code>nginx.conf.erb</code> file it\r\nis entirely configurable and only exists as a form of documentation.\r\n\r\n### Known Issues\r\n\r\nOn pushing to OpenShift you'll see an error that looks something like this:\r\n\r\n\tremote: Starting Nginx\r\n\tremote: nginx: [alert] could not open error log file: open() \"error.log\" failed (2: No such file or directory)\r\n\r\nThis seems to be something going odd during the deployment process, as when NGINX is running the error.log is written to and shows errors correctly when viewing the file.\r\n\r\nUnless you upgrade the amount of storage available you only have 1 gigabyte of space per gear, this includes the git repository which will track your static content folder. Due to the way this stuff is copied around the OpenShift gear, with 1 gig of space, you'll be able to fit somewhere around 300 megabytes of static content before youll need to add more storage to your gear(s).\r\n\r\n### Compile options\r\n\r\nFor those interested in upgrading this yourself at some point, perhaps for your own fork which you maintain, this is how I've done updates:\r\n\r\nSSH to an OpenShift gear (<code>rhc app-show appname</code> to get the address), go to $OPENSHIFT_TMP_DIR (<code>$ cd $OPENSHIFT_TMP_DIR</code>) and do a wget for the latest NGINX and PCRE and unpack them. Navigate into the created NGINX folder and you can configure the install, I've used this when compiling the binary included in this cartridge:\r\n\r\n\t./configure --with-pcre=/tmp/pcre-8.36 --http-log-path=logs/access.log --error-log-path=logs/error.log --with-http_gzip_static_module --with-http_stub_status_module --with-http_ssl_module\r\n\r\nRun a <code>make</code> and when it is done copy the binary at <code>objs/nginx</code> to $OPENSHIFT_DATA_DIR (<code>cp objs/nginx $OPENSHIFT_DATA_DIR</code>) exit the SSH session. Now you can scp the file to your local machine (to which you've cloned this cartridge repository). Place the binary in the properly named <code>usr</code> folder, and update the manifest file in the metadata folder, and some of the files in the bin folder. Push it to a repo somewhere, test it on a new OpenShift gear.\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}